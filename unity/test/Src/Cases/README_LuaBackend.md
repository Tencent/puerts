# PuerTS Lua Backend 测试用例

本文档描述了为PuerTS Lua backend添加的测试用例，这些测试用例基于GitHub issue #2108的要求进行设计。

## 测试文件结构

### 1. LuaBackendTest.cs
基本的Lua语法和功能测试，包括：
- 基本语法测试（变量、函数、条件语句、循环）
- Lua表（table）操作
- 字符串操作
- 数学运算
- 闭包和元表
- 协程
- 错误处理
- 模块系统

### 2. LuaCrossLangTest.cs
Lua与C#交互的测试，包括：
- Lua调用C#静态方法
- Lua访问C#属性和实例方法
- Lua处理C#的out和ref参数
- Lua调用C#委托
- Lua访问C#枚举、结构体、数组等类型
- Lua处理C#的null值
- Lua访问C#泛型方法

### 3. LuaPerformanceTest.cs
Lua性能测试，包括：
- Lua循环性能
- 函数调用性能
- 表操作性能
- 字符串操作性能
- 数学运算性能
- 闭包和元表性能
- 协程性能
- 内存分配和垃圾回收性能
- Lua与C#交互的性能测试

### 4. LuaErrorHandlingTest.cs
Lua错误处理和异常测试，包括：
- Lua语法错误
- Lua运行时错误
- pcall和xpcall错误处理
- assert函数测试
- 类型错误、索引错误、调用错误
- 算术错误、内存错误
- 协程错误、元表错误
- Lua调用C#时的异常处理
- 错误恢复机制

### 5. LuaModuleTest.cs
Lua模块系统测试，包括：
- 模块定义和使用
- 模块中的局部变量
- 模块使用元表
- 模块继承
- 单例模式
- 工厂模式
- 观察者模式
- 状态机
- 事件系统
- 配置管理
- 缓存系统
- 验证系统
- 序列化
- 定时器
- 对象池

## Lua资源文件

### 1. lua_test_module.lua
测试用的Lua模块，包含：
- 基本数学运算函数
- 字符串操作函数
- 表操作函数
- 类型检查函数
- 常量和私有变量

### 2. lua_config.lua
Lua配置文件示例，包含：
- 应用设置
- 数据库设置
- 网络设置
- 日志设置
- 缓存设置
- 安全设置
- 配置获取和设置函数
- 配置验证函数

### 3. lua_utils.lua
Lua工具类，包含：
- 字符串工具函数
- 表操作工具函数
- 数组工具函数
- 数学工具函数
- 时间格式化函数
- 类型检查函数
- 调试工具函数
- 错误处理工具函数
- 缓存、防抖、节流工具函数

## 测试覆盖范围

### 基本功能测试
- ✅ Lua基本语法
- ✅ 变量和数据类型
- ✅ 函数定义和调用
- ✅ 控制结构（if、for、while）
- ✅ 表（table）操作
- ✅ 字符串操作
- ✅ 数学运算
- ✅ 闭包和元表
- ✅ 协程
- ✅ 错误处理

### 跨语言交互测试
- ✅ Lua调用C#静态方法
- ✅ Lua访问C#实例方法和属性
- ✅ Lua处理C#参数（out、ref）
- ✅ Lua调用C#委托
- ✅ Lua访问C#类型（枚举、结构体、数组等）
- ✅ Lua处理C# null值
- ✅ Lua访问C#泛型

### 性能测试
- ✅ Lua内部操作性能
- ✅ Lua与C#交互性能
- ✅ 内存使用和垃圾回收
- ✅ 大规模数据处理

### 错误处理测试
- ✅ Lua内部错误处理
- ✅ Lua与C#交互时的错误处理
- ✅ 错误恢复机制
- ✅ 异常传播

### 模块系统测试
- ✅ 模块定义和加载
- ✅ 模块间依赖
- ✅ 设计模式实现
- ✅ 工具类和库

## 使用方法

1. 确保PuerTS已正确配置Lua backend
2. 运行Unity测试框架
3. 执行相应的测试用例
4. 检查测试结果和性能数据

## 注意事项

1. 这些测试用例假设PuerTS已经支持Lua backend
2. 某些测试可能需要根据实际的Lua backend实现进行调整
3. 性能测试的结果可能因硬件环境而异
4. 错误处理测试中的某些异常可能需要根据实际的错误处理机制进行调整

## 扩展建议

1. 添加更多Lua标准库的测试
2. 增加Lua与Unity特定功能的交互测试
3. 添加Lua代码热更新的测试
4. 增加Lua调试功能的测试
5. 添加Lua与其他backend的对比测试

## 相关链接

- [GitHub Issue #2108](https://github.com/Tencent/puerts/issues/2108)
- [PuerTS官方文档](https://github.com/Tencent/puerts)
- [Lua官方文档](https://www.lua.org/manual/) 